<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>UPSC/OPSC Answer Evaluation</title>
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- PDF text & render -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.3.136/pdf.min.js" integrity="sha512-Nt7i6fCkY3Z9m5fT2v9KcN4bAqH9z8wK8rI9tYk8y9Lh8xM5YZo7kwl6nI1JJfQq2cV7P8fX7t6oXr7M3wQ0HQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
  <script>
    // worker for pdf.js
    pdfjsLib.GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.3.136/pdf.worker.min.js";
  </script>

  <!-- DOCX extraction (browser build) -->
  <script src="https://unpkg.com/mammoth/mammoth.browser.min.js"></script>

  <!-- PPTX extraction -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <!-- Toasts (tiny) -->
  <style>
    .spinner { border: 3px solid #eee; border-top: 3px solid #333; border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite;}
    @keyframes spin { 100% { transform: rotate(360deg);} }
  </style>
</head>
<body class="bg-gray-50 text-gray-900">
  <div class="max-w-2xl mx-auto p-4 sm:p-6">
    <header class="mb-6">
      <h1 class="text-2xl font-semibold">UPSC / OPSC Answer Evaluation</h1>
      <p class="text-sm text-gray-600">Upload answer sheets (PNG, JPG, PDF, PPTX, DOCX). We’ll extract text first and run OCR only when needed. Then a strict evaluator scores as per UPSC/OPSC style.</p>
    </header>

    <section class="bg-white rounded-xl shadow p-4 sm:p-6 space-y-4">
      <div>
        <label class="block text-sm font-medium">Question / Prompt (required)</label>
        <textarea id="question" class="mt-1 w-full rounded-lg border p-3" rows="3" placeholder="Paste the exact question here..."></textarea>
      </div>

      <div class="grid grid-cols-1 sm:grid-cols-3 gap-4">
        <div>
          <label class="block text-sm font-medium">Max Marks</label>
          <input id="maxMarks" type="number" class="mt-1 w-full rounded-lg border p-3" placeholder="10 / 15 / 20" value="15" />
        </div>
        <div>
          <label class="block text-sm font-medium">Paper Type</label>
          <select id="examType" class="mt-1 w-full rounded-lg border p-3">
            <option value="GS">GS</option>
            <option value="Essay">Essay</option>
            <option value="Optional">Optional</option>
          </select>
        </div>
        <div>
          <label class="block text-sm font-medium">Time Limit (mins)</label>
          <input id="timeLimit" type="number" class="mt-1 w-full rounded-lg border p-3" placeholder="Optional, e.g. 7" />
        </div>
      </div>

      <div class="border-2 border-dashed rounded-xl p-4 text-center cursor-pointer bg-gray-50 hover:bg-gray-100" id="dropzone">
        <input id="fileInput" type="file" class="hidden" multiple accept=".pdf,.docx,.pptx,image/png,image/jpeg" />
        <p class="text-sm">Drag & drop files here, or <button id="browseBtn" class="underline text-blue-600">browse</button></p>
        <p class="text-xs text-gray-500 mt-1">Accepted: PDF, DOCX, PPTX, PNG, JPG (max ~10 files, up to ~30MB total recommended)</p>
      </div>

      <ul id="fileList" class="space-y-2"></ul>

      <div class="flex items-center gap-3">
        <button id="evaluateBtn" class="px-4 py-2 rounded-lg bg-blue-600 text-white disabled:opacity-50">Evaluate</button>
        <div id="busy" class="hidden items-center gap-2"><div class="spinner"></div><span class="text-sm">Processing…</span></div>
      </div>
    </section>

    <section id="result" class="mt-6 hidden">
      <div class="bg-white rounded-xl shadow p-4 sm:p-6 space-y-4">
        <h2 class="text-xl font-semibold">Result</h2>
        <div id="scoreCard" class="text-sm"></div>
        <div id="breakdown" class="text-sm"></div>
        <div id="feedback" class="text-sm"></div>
      </div>
    </section>
  </div>

  <script src="/public/app.js" type="module"></script>
</body>
</html>
